<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>New Transaction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" th:href="@{/styles/stylesheader.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/styles/stylesfooter.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/styles/stylesnewtransaction.css}" type="text/css">
    <script>
        // Function to pre-fill the form fields
        // function prefillForm(senderAccountNumber, payeeAccountNumber) {
        //     $('#senderAccount').val(senderAccountNumber);
        //     $('#payeeAccount').val(payeeAccountNumber);
        // }
        //
        // // Function to get the query parameter value from URL
        // function getQueryParam(name) {
        //     const urlParams = new URLSearchParams(window.location.search);
        //     return urlParams.get(name);
        // }
        //
        // // Call the prefillForm function when the page loads
        // window.onload = function() {
        //     const dropdownAccountNumber = getQueryParam('dropdownAccountNumber');
        //     const cardAccountNumber = getQueryParam('cardAccountNumber');
        //     prefillForm(dropdownAccountNumber, cardAccountNumber);
        // };

        $(document).ready(()=>{
            const transData=JSON.parse(sessionStorage.getItem('dataN'));
            $('#senderAccount').val(transData.sender);
            $('#payeeAccount').val(transData.payee);
            sessionStorage.clear();
            $("#send").click(()=>{
                alert('clicked')
                const senderAcc=$("#senderAccount").val()
                const payeeAcc=$("#payeeAccount").val()
                const transactionType=$('input[name="transactionType"]:checked').val()
                const amount=$("#amount").val()

                const request={
                    "transactionFrom":senderAcc,
                    "transactionTo":payeeAcc,
                    "transactionType":transactionType,
                    "transactionAmount":amount
                }
                alert(request)
                console.log(JSON.stringify(request))
                $.ajax({
                    url:"/transactions/new",
                    type:"POST",
                    dataType:"text",
                    contentType:"application/json;charset=utf-8",
                    data:JSON.stringify(request),
                    success:function(response){
                        alert(response)
                        let element=$("#status")
                        element.append(`<h1>Transaction to ${payeeAcc} is success</h1>`)
                        element.empty()
                    },
                    error:function(xhr, status, error){
                        alert("Error: " + xhr.responseText);//exception in alert
                        let element=$("#status")
                        element.append(`<h1>Transaction to ${payeeAcc} is failed</h1>`)
                        element.empty()
                    }
                })

            })
        })
    </script>
</head>
<body>
<header><div th:insert="header::menu"></div></header>
<h2>Make Payment</h2>
<div class="container ">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-9 col-12">
            <div class="card">
                <div class="card-body">
                    <p id="status" class="display-5 text-center text-bg-danger"></p>
<!--                    <form action="#" method="post">-->
                        <div class="mb-3">
                            <label>Sender Account Number</label>
                            <input type="text" class="form-control" id="senderAccount" name="senderAccountNumber" readonly>
                        </div>
                        <div class="mb-3">
                            <label>Payee Account Number</label>
                            <input type="text" class="form-control" id="payeeAccount" name="payeeAccountNumber" readonly>
                        </div>
                        <div class="form-group">
                            <label >Transaction Type</label>
                            <div class="radio-container">
                                <input type="radio" name="transactionType" id="imps" value="IMPS">
                                <label for="imps">IMPS</label>
                                <input type="radio" name="transactionType" id="neft" value="NEFT">
                                <label for="neft">NEFT</label>
                                <input type="radio" name="transactionType" id="rtgs" value="RTGS">
                                <label for="rtgs">RTGS</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount to be transferred</label>
                            <input type="text" class="form-control" id="amount" name="amount" required pattern="\d+(\.\d{2})?">
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-auto">
                                <input class="btn btn-primary" type="submit" value="Send" id="send">
                            </div>
                            <div class="col-auto">
                                <input class="btn btn-primary" type="reset" value="Cancel">
                            </div>
                        </div>
<!--                    </form>-->
                </div>
            </div>
        </div>
    </div>
</div>
<footer ><div th:insert="footer::footer"></div></footer>
</body>
</html>